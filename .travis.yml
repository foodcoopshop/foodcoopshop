language: php
 
php:
  - 7.1

services:
  - mysql

env:
  - DB=mysql
  
before_script:
  - git clone --depth 1 git://github.com/foodcoopshop/foodcoopshop
  - mysql -e 'CREATE DATABASE foodcoopshop_test;'
  - mysql foodcoopshop_test < ./Test/test_files/Config/sql/test-db-structure.sql
  - mysql foodcoopshop_test < ./Test/test_files/Config/sql/test-db-data.sql
  - composer install --prefer-dist
  - mv ./Config/credentials.default.php ./Config/credentials.php
  - echo "<?php
    class DATABASE_CONFIG {
        public \$default = array(
            'datasource' => 'Database/Mysql',
            'persistent' => false,
            'database' => 'foodcoopshop_test',
            'host' => '127.0.0.1',
            'login' => 'travis',
            'password' => '',
            'encoding' => 'utf8'
        );
        public \$test = array(
            'datasource' => 'Database/Mysql',
            'persistent' => false,
            'database' => 'foodcoopshop_test',
            'host' => '127.0.0.1',
            'login' => 'travis',
            'password' => '',
            'encoding' => 'utf8'
        );
    }" > ./Config/database.php
    - cat ./Config/database.php
 
script:
  - ./Console/cake test Controller/Component/StringComponent.php --stderr
  
notifications:
  email: false
  